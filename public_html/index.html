<!DOCTYPE html>
<html>
    <head>
        <title>Connect the Dots</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="text/css" rel="stylesheet" href="css/main_style.css" />
        <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
        <script type="text/javascript">
            // Ensure entire page is rendered in the browser before JS code is executed
            $(document).ready(function()
            {
                console.log('DOM loaded and ready to be manipulated.');
                
                var canvas = document.getElementById("canvas"); // Get element that has id set to "canvas"
                var ctx = canvas.getContext("2d"); // 2D Graphics context
                fitToContainer(canvas); // call method to adjust canvas to the size of the div container
                                
                canvas.addEventListener("click", placeDot, true); // Add event listener to place dots on canvas whenever a click happens on canvas box
                
                // Array that contains all the unique dots
                var dotSet = [];
                
                // Array used for permutations
                var permArr = [];
                var usedChars = [];
                var initialOrder = [];
                
                // Determine whether submit button is clicked
                document.getElementById('submit').onclick = function()
                {
                    var numDots = dotSet.length;
                    console.log("Number of dot elements: " + numDots);
                    
                    // Iterate dot objects with forEach
                    dotSet.forEach(function(dotObj) 
                    {
                        console.log(dotObj);
                    });
                    
                    // Populate initial order of iterating through dot array
                    for(var i = 0; i < numDots; i++)
                    {
                         initialOrder[i] = i;
                    }
                    
                    var iteratePermutations = permute(initialOrder);
                    console.log(JSON.stringify(iteratePermutations));
                    
                    /*connectTheDots();*/
                }
                
                function connectTheDots() 
                { 
                    ctx.beginPath(); // Creates a new path 
                    var initialDotObjSet = true;
                    
                    // Iterate set entries with forEach 
                    dotSet.forEach(function(dotObj) 
                    {
                        // Set initial coordinate point
                        if(initialDotObjSet)
                        {
                            ctx.moveTo(dotObj.x, dotObj.y); // initial position of pen
                            initialDotObjSet = false;
                        }
                        
                        // Draw line from current point to destination point
                        else
                        {
                            ctx.lineTo(dotObj.x, dotObj.y); // draw straight line to this dot 
                        }
                    }); 
                    
                    ctx.closePath(); 
                    ctx.stroke(); 
                }           
                
                /**
                 * Method to place a dot on the {x-coordinate, y-coordinate}, which 
                 * is determined by the location of the click.
                 * @type Arguments
                 */
                function placeDot(e)
                {
                    // Normalize the coordinates relative to the canvas area   
                    var parentPosition = getPosition(e.currentTarget);
    
                    // Get the x-coordinate and y-coordinate of the click
                    var xCoordinate = e.clientX - parentPosition.x; // Get x-coordinate of click
                    var yCoordinate = e.clientY - parentPosition.y; // Get y-coordinate of click
                    console.log("(X, Y) = (" + xCoordinate + ", " + yCoordinate + ")"); 
                    
                    // Draw dot that is 5 pixels wide and 5 pixels high on canvas
                    ctx.fillRect(xCoordinate, yCoordinate, 5, 5);
                    
                    // Add dot object to Set
                    var dotObject = {x: xCoordinate, y: yCoordinate}; // store the x and y coordinates of a dot
                    
                    // Determine if dot object already exists in array
                    var doesDotObjExist = dotSet.some(function(curDotObj)
                    {
                        return curDotObj.x === dotObject.x && curDotObj.y === dotObject.y;
                    });
                    
                    // Only add unique dot object to set
                    if(!doesDotObjExist)
                    {
                        dotSet.push(dotObject);
                    }
                }
                
                /**
                 * Algorithm to determine if two given line segments intersect
                 * Source: http://jsfiddle.net/justin_c_rounds/Gd2S2/
                 * @type Arguments
                 */
                function checkLineIntersection(line1StartX, line1StartY, line1EndX, line1EndY, line2StartX, line2StartY, line2EndX, line2EndY)
                {
                    // if the lines intersect, the result contains the x and y of the intersection (treating the lines as infinite) and booleans for whether line segment 1 or line segment 2 contain the point
                    var denominator, a, b, numerator1, numerator2, result = {
                        x: null,
                        y: null,
                        onLine1: false,
                        onLine2: false
                    };
                    
                    denominator = ((line2EndY - line2StartY) * (line1EndX - line1StartX)) - ((line2EndX - line2StartX) * (line1EndY - line1StartY));
                    
                    if (denominator == 0)
                    {
                        return result;
                    }   
    
                    a = line1StartY - line2StartY;
                    b = line1StartX - line2StartX;
                    numerator1 = ((line2EndX - line2StartX) * a) - ((line2EndY - line2StartY) * b);
                    numerator2 = ((line1EndX - line1StartX) * a) - ((line1EndY - line1StartY) * b);
                    a = numerator1 / denominator;
                    b = numerator2 / denominator;

                    // if we cast these lines infinitely in both directions, they intersect here:
                    result.x = line1StartX + (a * (line1EndX - line1StartX));
                    result.y = line1StartY + (a * (line1EndY - line1StartY));

                    /*
                    // it is worth noting that this should be the same as:
                        x = line2StartX + (b * (line2EndX - line2StartX));
                        y = line2StartX + (b * (line2EndY - line2StartY));
                    */
                    
                    // if line1 is a segment and line2 is infinite, they intersect if:
                    if (a > 0 && a < 1) 
                    {
                        result.onLine1 = true;
                    }
    
                    // if line2 is a segment and line1 is infinite, they intersect if:
                    if (b > 0 && b < 1) 
                    {
                        result.onLine2 = true;
                    }
    
                    // if line1 and line2 are segments, they intersect if both of the above are true
                    return result;
                }
                
                /**
                 * Permute an array 
                 * @type input array of integers 
                 * @return 2D array with all permutations
                 */
                function permute(input) 
                {
                    var i, ch;
                    
                    for (i = 0; i < input.length; i++) 
                    {
                        ch = input.splice(i, 1)[0];
                        usedChars.push(ch);
    
                        if (input.length == 0) 
                        {
                            permArr.push(usedChars.slice());
                        }
    
                        permute(input);
                        input.splice(i, 0, ch);
                        usedChars.pop();                  
                    }
                    
                    return permArr;
                }

                /**
                 * This method is used to normalize the x-coordinate and y-coordinate relative to an area
                 * rather than the entire page.
                 * @param {type} element
                 * @returns object with properties x and y
                 */
                function getPosition(element) 
                {
                    var xPosition = 0;
                    var yPosition = 0;

                    while (element) 
                    {
                        xPosition += (element.offsetLeft - element.scrollLeft + element.clientLeft);
                        yPosition += (element.offsetTop - element.scrollTop + element.clientTop);
                        element = element.offsetParent;
                    }
                    
                    return { x: xPosition, y: yPosition };
                }
        
                /**
                 * Method to adjust the canvas size according to the parent element
                 * @param {type} canvas
                 * @returns {undefined}
                 */
                function fitToContainer(canvas)
                {
                  // Make it visually fill the positioned parent
                  canvas.style.width ='100%';
                  canvas.style.height='100%';
                  
                  // ...then set the internal size to match
                  canvas.width  = canvas.offsetWidth;
                  canvas.height = canvas.offsetHeight;
                }
            });  
        </script>
    </head>
    <body>
        <div id="puzzle" class="dotbox">
            <canvas id="canvas">
            </canvas>
        </div>
        
        <div class="buttonbox">
            <input class="button" type="button" id="submit" value="Solve" />
        </div>
    </body>
</html>
